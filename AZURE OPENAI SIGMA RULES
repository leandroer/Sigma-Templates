title: Azure OpenAI Excessive Token Consumption
id: 11a1b2c3-d4e5-4f6a-b7c8-9d0e1f2a3b4c
status: experimental
description: Detects unusually high token usage in Azure OpenAI services indicating potential abuse
references:
    - https://learn.microsoft.com/en-us/azure/ai-services/openai/
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.exfiltration
    - attack.t1567
    - ai.azure_openai
    - ai.token_abuse
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceProvider: 'MICROSOFT.COGNITIVESERVICES'
        Category: 
            - 'RequestResponse'
            - 'Audit'
    filter_tokens:
        properties.total_tokens|gte: 50000
    timeframe: 5m
    condition: selection and filter_tokens
falsepositives:
    - Legitimate batch processing
    - High-volume production applications
level: high

-------------------------------------------
title: Azure OpenAI Prompt Injection Attack
id: 22b2c3d4-e5f6-4a7b-c8d9-0e1f2a3b4c5d
status: experimental
description: Detects prompt injection attempts in Azure OpenAI deployments
references:
    - https://simonwillison.net/2023/Apr/14/worst-that-can-happen/
    - https://github.com/greshake/llm-security
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.initial_access
    - attack.t1190
    - ai.azure_openai
    - ai.prompt_injection
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceProvider: 'MICROSOFT.COGNITIVESERVICES'
        Category: 'RequestResponse'
    keywords:
        properties.prompt|contains:
            - 'ignore previous instructions'
            - 'ignore all previous'
            - 'disregard previous'
            - 'forget everything'
            - 'system:'
            - 'you are now'
            - 'new role'
            - 'jailbreak'
            - 'DAN'
            - 'developer mode'
            - 'SUDO'
            - 'override safety'
            - 'bypass filter'
            - 'unrestricted mode'
            - '<|endoftext|>'
            - '<|im_start|>'
            - '<|im_end|>'
    condition: selection and keywords
falsepositives:
    - Authorized security testing
    - AI safety research with approval
level: high

---------------------------------------------------------
title: Azure OpenAI Content Filter High Severity Triggers
id: 33c3d4e5-f6a7-4b8c-d9e0-1f2a3b4c5d6e
status: experimental
description: Detects high-severity content filter triggers in Azure OpenAI
references:
    - https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/content-filter
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.impact
    - attack.t1499
    - ai.azure_openai
    - ai.content_abuse
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceProvider: 'MICROSOFT.COGNITIVESERVICES'
        Category: 'RequestResponse'
    filter_severity:
        - properties.content_filter_result.prompt.hate.severity|gte: 4
        - properties.content_filter_result.prompt.self_harm.severity|gte: 4
        - properties.content_filter_result.prompt.sexual.severity|gte: 4
        - properties.content_filter_result.prompt.violence.severity|gte: 4
    condition: selection and 1 of filter_severity
falsepositives:
    - Content moderation testing
    - Security research activities
level: high

---
title: Azure OpenAI API Key Compromise
id: 44d4e5f6-a7b8-4c9d-e0f1-2a3b4c5d6e7f
status: experimental
description: Detects potential Azure OpenAI API key compromise through multi-location usage
references:
    - https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/managed-identity
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.credential_access
    - attack.t1552
    - ai.azure_openai
    - ai.key_compromise
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceProvider: 'MICROSOFT.COGNITIVESERVICES'
    timeframe: 1h
    condition: selection | count(distinct CallerIPAddress) by properties.apiKeyId > 5
falsepositives:
    - Distributed applications with load balancing
    - CDN or proxy usage
level: high

----------------------------------------------------
title: Azure OpenAI Data Exfiltration via Embeddings
id: 55e5f6a7-b8c9-4d0e-f1a2-3b4c5d6e7f8a
status: experimental
description: Detects potential data exfiltration through Azure OpenAI embeddings API
references:
    - https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/understand-embeddings
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.exfiltration
    - attack.t1567
    - ai.azure_openai
    - ai.embeddings_abuse
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceProvider: 'MICROSOFT.COGNITIVESERVICES'
        OperationName|contains: 'OpenAI.Embeddings'
    timeframe: 1h
    condition: selection | count(CallerIPAddress) by identity_claims_upn_s > 100
falsepositives:
    - Vector database operations
    - Semantic search implementations
level: medium
