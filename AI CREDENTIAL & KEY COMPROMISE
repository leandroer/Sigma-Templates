title: AI API Key Usage from Multiple Geographic Locations
id: c5d6e7f8-a9b0-4c5d-e9f8-5a6b7c8d9e0f
status: experimental
description: Detects API key usage from multiple IPs/locations indicating potential compromise
references:
    - https://owasp.org/www-community/attacks/credential_stuffing
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.credential_access
    - attack.t1552
    - ai.key_compromise
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceType: 'COGNITIVESERVICES'
    timeframe: 1h
    condition: selection | count(distinct CallerIPAddress) by identity_claims_appid_g > 5
falsepositives:
    - Distributed applications
    - Load-balanced services
level: high

----------------------------------------
title: AI Service Key Extraction Attempt
id: d6e7f8a9-b0c1-4d5e-f9a8-6b7c8d9e0f1a
status: experimental
description: Detects attempts to retrieve AI service API keys or secrets
references:
    - https://attack.mitre.org/techniques/T1552/
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.credential_access
    - attack.t1552.001
    - ai.key_theft
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        OperationName|contains:
            - 'ListKeys'
            - 'GetKeys'
            - 'RegenerateKey'
            - 'SecretGet'
        ResourceType:
            - 'COGNITIVESERVICES'
            - 'MACHINELEARNINGSERVICES'
            - 'KEYVAULT'
    condition: selection
falsepositives:
    - Legitimate key rotation
    - Authorized administrative access
level: high

-------------------------------------------------
title: Anomalous Geographic Access to AI Services
id: e7f8a9b0-c1d2-4e5f-a9b8-7c8d9e0f1a2b
status: experimental
description: Detects access to AI services from unexpected geographic locations
references:
    - https://www.microsoft.com/en-us/security/blog/
author: Security Operations Team
date: 2024-01-01
modified: 2024-01-01
tags:
    - attack.initial_access
    - attack.t1078
    - ai.geographic_anomaly
logsource:
    product: azure
    service: cognitiveservices
detection:
    selection:
        ResourceType:
            - 'COGNITIVESERVICES'
            - 'MACHINELEARNINGSERVICES'
    filter_location:
        location_s|ne:
            - 'United States'
            - 'Canada'
            - 'United Kingdom'
    condition: selection and filter_location
falsepositives:
    - Travel
    - Remote workers
    - Global operations
level: medium
